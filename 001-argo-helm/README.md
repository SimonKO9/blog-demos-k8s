# ArgoCD + Helm

In this directory, you will find files showcasing a Helm Chart deployment with Helm, using different methods and covering different scenarios.

## Prerequisites

1. Kubernetes cluster (see [check the guide for setting up a local k8s cluster using kind](../000-local-k8s/)).
2. Kubectl
3. Helm

## Deploy ArgoCD

```sh
ARGOCD_VERSION="v3.0.11"
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/${ARGOCD_VERSION}/manifests/install.yaml
```

## Login to ArgoCD

First, grab the autogenerated password:

```sh
kubectl get secret -n argocd argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

Then, forward port to access the UI:
```sh
kubectl port-forward svc/argocd-server -n argocd 8080:44kubectl port-forward svc/argocd-server -n argocd 8080:4433
```

Go to https://localhost:8080 in your browser and sign in as `admin` using the password you just retrieved.

## Deploy apps

```sh
kubectl apply -f application-direct.yaml
kubectl apply -f application-umbrella-chart.yaml
```

## Check if apps are deployed

Two applications should appear in Argo UI. They should both show healthy and synced.

You can also inspect the pods:

```sh
$ kubectl get po -n umbrella
NAME                                        READY   STATUS    RESTARTS   AGE
argo-helm-umbrella-nginx-7c6bb7f75c-jnng5   1/1     Running   0          9m25s

$ kubectl get po -n direct
NAME                                      READY   STATUS    RESTARTS   AGE
argo-helm-direct-nginx-75dc444664-vhvfp   1/1     Running   0          113s
```

## Private repository

Accessing private repositories requires creation of repo secret.

See `private-repository.yaml`, `application-direct.yaml` and `application-umbrella-chart.yaml` files for reference.